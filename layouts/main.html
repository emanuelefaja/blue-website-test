{{define "main.html"}}
<!DOCTYPE html>
<html lang="en">
{{template "head" .}}
<body x-data="{ 
        sidebarsOpen: true,
        scrollProgress: 0
    }" 
    @scroll.window="scrollProgress = Math.round((window.pageYOffset / (document.documentElement.scrollHeight - document.documentElement.clientHeight)) * 100)"
    class="bg-white overflow-x-hidden">
    {{template "topbar" .}}
    
    <!-- Main Layout -->
    <div class="flex pt-16 min-h-screen">
        {{template "left-sidebar" .}}
        
        <!-- Main Content Area -->
        <main class="flex-1 bg-white">
            <div class="flex">
                <!-- Content Area -->
                <div class="flex-1 px-8 pt-16 pb-4">
                    <div class="max-w-6xl mx-auto">
                        {{if .IsMarkdown}}
                        <div class="py-20 prose prose-lg prose-slate max-w-none prose-headings:text-gray-900 prose-p:text-gray-700 prose-strong:text-gray-900 prose-code:text-blue-600 prose-code:bg-blue-50 prose-code:px-1 prose-code:py-0.5 prose-code:rounded">
                            {{if .Frontmatter}}
                            <h1 class="text-4xl md:text-6xl lg:text-6xl font-medium tracking-tight text-gray-900 mb-8">{{.Frontmatter.Title}}</h1>
                            {{if .Frontmatter.Description}}
                            <p class="text-xl text-gray-600">{{.Frontmatter.Description}}</p>
                            {{end}}
                            <hr class="mt-1 mb-8 border-gray-200 dark:border-gray-700">
                            {{end}}
                            {{.Content}}
                        </div>
                        {{else}}
                        {{.Content}}
                        {{end}}
                        
                        <!-- Copyright Notice -->
                        <div class="text-center mt-8 pt-4 border-t border-gray-200">
                            <span class="text-sm leading-6 text-gray-600">¬© Blue <span x-text="new Date().getFullYear()"></span> ‚Äî Designed with <span class="text-red-500 animate-pulse">‚ù§</span> across the üåè</span>
                        </div>
                    </div>
                </div>
                
                {{template "right-sidebar" .}}
            </div>
        </main>
    </div>
    

    <script>       
        // Client-side routing for smooth navigation
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Highlight.js
            hljs.highlightAll();
            
            function addCopyButtons() {
                const codeBlocks = document.querySelectorAll('.prose pre:not([data-copy-added])');
                codeBlocks.forEach(pre => {
                    pre.setAttribute('data-copy-added', 'true');
                    
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'code-copy-btn';
                    copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                    copyBtn.title = 'Copy code';
                    
                    copyBtn.addEventListener('click', async () => {
                        const code = pre.querySelector('code');
                        const text = code ? code.textContent : pre.textContent;
                        
                        try {
                            await navigator.clipboard.writeText(text);
                            copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                            copyBtn.classList.add('copied');
                            copyBtn.title = 'Copied!';
                            
                            setTimeout(() => {
                                copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                                copyBtn.classList.remove('copied');
                                copyBtn.title = 'Copy code';
                            }, 2000);
                        } catch (err) {
                            console.error('Failed to copy:', err);
                        }
                    });
                    
                    pre.appendChild(copyBtn);
                });
            }
            
            function setupClientRouting() {
                const navLinks = document.querySelectorAll('a[href^="/"]');
                navLinks.forEach(link => {
                    // Skip external links and special links
                    if (link.target === '_blank' || link.href.includes('#')) return;
                    
                    // Prefetch on hover
                    link.addEventListener('mouseenter', () => {
                        const prefetchLink = document.createElement('link');
                        prefetchLink.rel = 'prefetch';
                        prefetchLink.href = link.href;
                        document.head.appendChild(prefetchLink);
                    });
                    
                    // Handle click
                    link.addEventListener('click', async (e) => {
                        e.preventDefault();
                        
                        try {
                            const response = await fetch(link.href);
                            if (!response.ok) throw new Error('Network response was not ok');
                            
                            const html = await response.text();
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');
                            
                            const newMain = doc.querySelector('main');
                            const currentMain = document.querySelector('main');
                            
                            if (newMain && currentMain) {
                                // Update content
                                currentMain.innerHTML = newMain.innerHTML;
                                
                                // Update title
                                const newTitle = doc.querySelector('title');
                                if (newTitle) document.title = newTitle.textContent;
                                
                                // Update URL
                                window.history.pushState(null, '', link.href);
                                
                                // Update sidebar active state
                                const sidebar = document.querySelector('nav[x-data*="currentPath"]');
                                if (sidebar && sidebar._x_dataStack && sidebar._x_dataStack[0].updateCurrentPath) {
                                    sidebar._x_dataStack[0].updateCurrentPath(new URL(link.href).pathname);
                                }
                                
                                // Re-initialize content
                                hljs.highlightAll();
                                addCopyButtons();
                                
                                // Scroll to top
                                window.scrollTo({ top: 0, behavior: 'smooth' });
                                
                            } else {
                                window.location.href = link.href;
                            }
                        } catch (error) {
                            console.error('Client routing failed:', error);
                            window.location.href = link.href;
                        }
                    });
                });
            }
            
            // Handle browser back/forward
            window.addEventListener('popstate', () => {
                // Update sidebar active state for browser navigation
                const sidebar = document.querySelector('nav[x-data*="currentPath"]');
                if (sidebar && sidebar._x_dataStack && sidebar._x_dataStack[0].updateCurrentPath) {
                    sidebar._x_dataStack[0].updateCurrentPath(window.location.pathname);
                }
                window.location.reload();
            });
            
            // Initialize
            addCopyButtons();
            setupClientRouting();
        });
    </script>
</body>
</html>
{{end}}